@page "/"
@using MediatR
@using System
@using Pantrymo.Application.Features
@using Pantrymo.Application.Models.AppModels


@inject IMediator _mediator;

<input id="IngredientTextInput" @bind="IngredientText" @bind:event="oninput" @onkeyup="IngredientText_OnKeyUp" />
<ul class="list-group">
    @foreach(var ingredient in _ingredientSuggestions)
    {
        <li class="list-group-item list-group-item-light list-group-item-action" 
            data-value=@ingredient
            @onclick="()=> IngredientSuggestionClick(ingredient)">@ingredient</li>
    }
</ul>

<ul>
    @foreach(var result in _searchResults)
    {
        <li>@result.Title</li>
    }
</ul>

@code
{

    string IngredientText { get; set; }

    private string[] _ingredientSuggestions = new string[] { };
    private RecipeDetail[] _searchResults = new RecipeDetail[] { };

    public async void IngredientText_OnKeyUp(KeyboardEventArgs args)
    {
        await SuggestIngredients();
    }

    public async void IngredientSuggestionClick(string ingredient)
    {
        IngredientText = ingredient;
        await Task.Delay(1);
    }

    private async Task SuggestIngredients()
    {
        var suggestions = await _mediator.Send(new SuggestIngredientsFeature.Query(IngredientText,5));
        _ingredientSuggestions = suggestions;
        StateHasChanged();
    }

    private async Task DoRecipeSearch()
    {
        _searchResults = await _mediator.Send(new RecipeSearchFeature.Query(new string[]{IngredientText}, new string[]{"Italian"},0,10));
        StateHasChanged();
    }
}